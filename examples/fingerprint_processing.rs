/* examples/fingerprint_processing.rs */

use nextjlc_core::fingerprint::add_fingerprint;

// A sample of a Gerber file header.
// several lines starting with "%ADD", to see the fingerprinting in action.
const GERBER_SAMPLE: &str = r#"%TF.GenerationSoftware,KiCad,Pcbnew,8.0.6*%
%TF.CreationDate,2024-11-23T19:07:54+08:00*%
%TF.ProjectId,AK4497SEQ,414b3434-3937-4534-9551-2e6b69636164,rev?*%
%TF.SameCoordinates,Original*%
%TF.FileFunction,Copper,L1,Top*%
%TF.FilePolarity,Positive*%
%FSLAX46Y46*%
G04 Gerber Fmt 4.6, Leading zero omitted, Abs format (unit mm)*
G04 Created by KiCad (PCBNEW 8.0.6) date 2024-11-23 19:07:54*
%MOMM*%
%LPD*%
G01*
G04 APERTURE LIST*
G04 Aperture macros list*
%AMRoundRect*
0 Rectangle with rounded corners*
0 $1 Rounding radius*
0 $2 $3 $4 $5 $6 $7 $8 $9 X,Y pos of 4 corners*
0 Add a 4 corners polygon primitive as box body*
4,1,4,$2,$3,$4,$5,$6,$7,$8,$9,$2,$3,0*
0 Add four circle primitives for the rounded corners*
1,1,$1+$1,$2,$3*
1,1,$1+$1,$4,$5*
1,1,$1+$1,$6,$7*
1,1,$1+$1,$8,$9*
0 Add four rect primitives between the rounded corners*
20,1,$1+$1,$2,$3,$4,$5,0*
20,1,$1+$1,$4,$5,$6,$7,0*
20,1,$1+$1,$6,$7,$8,$9,0*
20,1,$1+$1,$8,$9,$2,$3,0*%
%AMRotRect*
0 Rectangle, with rotation*
0 The origin of the aperture is its center*
0 $1 length*
0 $2 width*
0 $3 Rotation angle, in degrees counterclockwise*
0 Add horizontal line*
21,1,$1,$2,0,0,$3*%
%AMFreePoly0*
4,1,25,0.173003,0.805415,0.279003,0.761415,0.311415,0.729003,0.355415,0.623003,0.360000,0.600000,0.360000,-0.600000,0.355415,-0.623003,0.311415,-0.729003,0.279003,-0.761415,0.173003,-0.805415,0.150000,-0.810000,-0.150000,-0.810000,-0.173003,-0.805415,-0.279003,-0.761415,-0.311415,-0.729003,-0.355415,-0.623003,-0.360000,-0.600000,-0.360000,0.600000,-0.355415,0.623003,-0.311415,0.729003,
-0.279003,0.761415,-0.173003,0.805415,-0.150000,0.810000,0.150000,0.810000,0.173003,0.805415,0.173003,0.805415,$1*%
G04 Aperture macros list end*
%TA.AperFunction,SMDPad,CuDef*%
%ADD10RoundRect,0.150000X0.150000X-0.512500X0.150000X0.512500X-0.150000X0.512500X-0.150000X-0.512500X0*%
%TD*%
%TA.AperFunction,SMDPad,CuDef*%
%ADD11RoundRect,0.225000X0.225000X0.250000X-0.225000X0.250000X-0.225000X-0.250000X0.225000X-0.250000X0*%
%TD*%
%TA.AperFunction,SMDPad,CuDef*%
%ADD12RoundRect,0.225000X-0.250000X0.225000X-0.250000X-0.225000X0.250000X-0.225000X0.250000X0.225000X0*%
%TD*%
%TA.AperFunction,SMDPad,CuDef*%
%ADD13RoundRect,0.250000X0.475000X-0.250000X0.475000X0.250000X-0.475000X0.250000X-0.475000X-0.250000X0*%
%TD*%
%TA.AperFunction,SMDPad,CuDef*%
%ADD14RoundRect,0.200000X-0.200000X-0.275000X0.200000X-0.275000X0.200000X0.275000X-0.200000X0.275000X0*%
%TD*%
%TA.AperFunction,SMDPad,CuDef*%
%ADD15RoundRect,0.200000X0.275000X-0.200000X0.275000X0.200000X-0.275000X0.200000X-0.275000X-0.200000X0*%
%TD*%
%TA.AperFunction,SMDPad,CuDef*%
%ADD16R,0.500000X0.800000*%
%TD*%
%TA.AperFunction,SMDPad,CuDef*%
%ADD17R,0.400000X0.800000*%
%TD*%
%TA.AperFunction,ComponentPad*%
%ADD18R,1.600000X1.600000*%
%TD*%
%TA.AperFunction,ComponentPad*%
%ADD19C,1.600000*%
%TD*%
%TA.AperFunction,SMDPad,CuDef*%
%ADD20RoundRect,0.100000X0.637500X0.100000X-0.637500X0.100000X-0.637500X-0.100000X0.637500X-0.100000X0*%
%TD*%
%TA.AperFunction,SMDPad,CuDef*%
%ADD21R,0.600000X1.450000*%
%TD*%
%TA.AperFunction,SMDPad,CuDef*%
%ADD22R,0.300000X1.450000*%
%TD*%
%TA.AperFunction,ComponentPad*%
%ADD23O,1.000000X2.100000*%
%TD*%
%TA.AperFunction,ComponentPad*%
%ADD24O,1.000000X1.600000*%
%TD*%
%TA.AperFunction,SMDPad,CuDef*%
%ADD25RoundRect,0.250000X-0.325000X-1.100000X0.325000X-1.100000X0.325000X1.100000X-0.325000X1.100000X0*%
%TD*%
%TA.AperFunction,SMDPad,CuDef*%
%ADD26RoundRect,0.150000X0.150000X-0.825000X0.150000X0.825000X-0.150000X0.825000X-0.150000X-0.825000X0*%
%TD*%
%TA.AperFunction,SMDPad,CuDef*%
%ADD27RoundRect,0.250000X1.500000X0.550000X-1.500000X0.550000X-1.500000X-0.550000X1.500000X-0.550000X0*%
%TD*%
%TA.AperFunction,SMDPad,CuDef*%
%ADD28RoundRect,0.200000X0.200000X0.275000X-0.200000X0.275000X-0.200000X-0.275000X0.200000X-0.275000X0*%
%TD*%
%TA.AperFunction,SMDPad,CuDef*%
%ADD29RoundRect,0.225000X-0.225000X-0.250000X0.225000X-0.250000X0.225000X0.250000X-0.225000X0.250000X0*%
%TD*%
%TA.AperFunction,SMDPad,CuDef*%
%ADD30RoundRect,0.150000X0.150000X-0.587500X0.150000X0.587500X-0.150000X0.587500X-0.150000X-0.587500X0*%
%TD*%
%TA.AperFunction,SMDPad,CuDef*%
%ADD31RoundRect,0.150000X-0.825000X-0.150000X0.825000X-0.150000X0.825000X0.150000X-0.825000X0.150000X0*%
%TD*%
%TA.AperFunction,ComponentPad*%
%ADD32R,1.700000X1.700000*%
%TD*%
%TA.AperFunction,ComponentPad*%
%ADD33O,1.700000X1.700000*%
%TD*%
%TA.AperFunction,SMDPad,CuDef*%
%ADD34RoundRect,0.250000X-0.450000X0.262500X-0.450000X-0.262500X0.450000X-0.262500X0.450000X0.262500X0*%
%TD*%
%TA.AperFunction,SMDPad,CuDef*%
%ADD35RoundRect,0.150000X-0.150000X0.587500X-0.150000X-0.587500X0.150000X-0.587500X0.150000X0.587500X0*%
%TD*%
%TA.AperFunction,SMDPad,CuDef*%
%ADD36RoundRect,0.200000X-0.275000X0.200000X-0.275000X-0.200000X0.275000X-0.200000X0.275000X0.200000X0*%
%TD*%
%TA.AperFunction,SMDPad,CuDef*%
%ADD37RoundRect,0.250000X0.550000X-1.500000X0.550000X1.500000X-0.550000X1.500000X-0.550000X-1.500000X0*%
%TD*%
%TA.AperFunction,ComponentPad*%
%ADD38O,1.500000X2.200000*%
%TD*%
%TA.AperFunction,ComponentPad*%
%ADD39O,1.500000X2.800000*%
%TD*%
%TA.AperFunction,ComponentPad*%
%ADD40O,2.800000X1.500000*%
%TD*%
%TA.AperFunction,ComponentPad*%
%ADD41O,1.500000X2.000000*%
%TD*%
%TA.AperFunction,SMDPad,CuDef*%
%ADD42RoundRect,0.150000X-0.150000X0.662500X-0.150000X-0.662500X0.150000X-0.662500X0.150000X0.662500X0*%
%TD*%
%TA.AperFunction,SMDPad,CuDef*%
%ADD43R,0.400000X1.200000*%
%TD*%
%TA.AperFunction,SMDPad,CuDef*%
%ADD44RoundRect,0.250000X-0.475000X0.250000X-0.475000X-0.250000X0.475000X-0.250000X0.475000X0.250000X0*%
%TD*%
%TA.AperFunction,SMDPad,CuDef*%
%ADD45RoundRect,0.250000X0.250000X0.475000X-0.250000X0.475000X-0.250000X-0.475000X0.250000X-0.475000X0*%
%TD*%
%TA.AperFunction,ComponentPad*%
%ADD46C,1.700000*%
%TD*%
%TA.AperFunction,SMDPad,CuDef*%
%ADD47R,2.700000X0.800000*%
%TD*%
%TA.AperFunction,ComponentPad*%
%ADD48C,1.422000*%
%TD*%
%TA.AperFunction,ComponentPad*%
%ADD49C,1.400000*%
%TD*%
%TA.AperFunction,SMDPad,CuDef*%
%ADD50RoundRect,0.140000X-0.140000X-0.170000X0.140000X-0.170000X0.140000X0.170000X-0.140000X0.170000X0*%
%TD*%
%TA.AperFunction,SMDPad,CuDef*%
%ADD51RoundRect,0.150000X-0.512500X-0.150000X0.512500X-0.150000X0.512500X0.150000X-0.512500X0.150000X0*%
%TD*%
%TA.AperFunction,SMDPad,CuDef*%
%ADD52RoundRect,0.250000X1.100000X-0.325000X1.100000X0.325000X-1.100000X0.325000X-1.100000X-0.325000X0*%
%TD*%
%TA.AperFunction,SMDPad,CuDef*%
%ADD53RoundRect,0.250000X-0.250000X-0.475000X0.250000X-0.475000X0.250000X0.475000X-0.250000X0.475000X0*%
%TD*%
%TA.AperFunction,ComponentPad*%
%ADD54O,1.350000X2.150000*%
%TD*%
%TA.AperFunction,ComponentPad*%
%ADD55O,2.150000X1.350000*%
%TD*%
%TA.AperFunction,SMDPad,CuDef*%
%ADD56RoundRect,0.587500X1.162500X-0.587500X1.162500X0.587500X-1.162500X0.587500X-1.162500X-0.587500X0*%
%TD*%
%TA.AperFunction,SMDPad,CuDef*%
%ADD57R,0.600000X1.200000*%
%TD*%
%TA.AperFunction,SMDPad,CuDef*%
%ADD58R,3.300000X2.400000*%
%TD*%
%TA.AperFunction,SMDPad,CuDef*%
%ADD59FreePoly0,270.000000*%
%TD*%
%TA.AperFunction,SMDPad,CuDef*%
%ADD60FreePoly0,0.000000*%
%TD*%
%TA.AperFunction,SMDPad,CuDef*%
%ADD61FreePoly0,90.000000*%
%TD*%
%TA.AperFunction,SMDPad,CuDef*%
%ADD62FreePoly0,180.000000*%
%TD*%
%TA.AperFunction,SMDPad,CuDef*%
%ADD63RoundRect,0.150000X-0.150000X0.512500X-0.150000X-0.512500X0.150000X-0.512500X0.150000X0.512500X0*%
%TD*%
%TA.AperFunction,SMDPad,CuDef*%
%ADD64RoundRect,0.140000X-0.170000X0.140000X-0.170000X-0.140000X0.170000X-0.140000X0.170000X0.140000X0*%
%TD*%
%TA.AperFunction,SMDPad,CuDef*%
%ADD65RoundRect,0.150000X0.150000X-0.662500X0.150000X0.662500X-0.150000X0.662500X-0.150000X-0.662500X0*%
%TD*%
%TA.AperFunction,SMDPad,CuDef*%
%ADD66RoundRect,0.140000X0.140000X0.170000X-0.140000X0.170000X-0.140000X-0.170000X0.140000X-0.170000X0*%
%TD*%
%TA.AperFunction,SMDPad,CuDef*%
%ADD67RoundRect,0.225000X0.250000X-0.225000X0.250000X0.225000X-0.250000X0.225000X-0.250000X-0.225000X0*%
%TD*%
%TA.AperFunction,SMDPad,CuDef*%
%ADD68RoundRect,0.075000X0.075000X-0.700000X0.075000X0.700000X-0.075000X0.700000X-0.075000X-0.700000X0*%
%TD*%
%TA.AperFunction,SMDPad,CuDef*%
%ADD69RoundRect,0.075000X0.700000X-0.075000X0.700000X0.075000X-0.700000X0.075000X-0.700000X-0.075000X0*%
%TD*%
%TA.AperFunction,HeatsinkPad*%
%ADD70R,5.000000X5.000000*%
%TD*%
%TA.AperFunction,SMDPad,CuDef*%
%ADD71R,0.800000X2.700000*%
%TD*%
%TA.AperFunction,SMDPad,CuDef*%
%ADD72R,1.000000X0.250000*%
%TD*%
%TA.AperFunction,SMDPad,CuDef*%
%ADD73R,1.200000X2.000000*%
%TD*%
%TA.AperFunction,SMDPad,CuDef*%
%ADD74R,1.575000X2.000000*%
%TD*%
%TA.AperFunction,SMDPad,CuDef*%
%ADD75R,2.000000X1.575000*%
%TD*%
%TA.AperFunction,SMDPad,CuDef*%
%ADD76RoundRect,0.150000X0.587500X0.150000X-0.587500X0.150000X-0.587500X-0.150000X0.587500X-0.150000X0*%
%TD*%
%TA.AperFunction,SMDPad,CuDef*%
%ADD77RoundRect,0.225000X0.225000X0.375000X-0.225000X0.375000X-0.225000X-0.375000X0.225000X-0.375000X0*%
%TD*%
%TA.AperFunction,SMDPad,CuDef*%
%ADD78RotRect,1.000000X1.050000X130.000000*%
%TD*%
%TA.AperFunction,SMDPad,CuDef*%
%ADD79RotRect,1.050000X2.200000X130.000000*%
%TD*%
%TA.AperFunction,SMDPad,CuDef*%
%ADD80RotRect,1.000000X1.050000X310.000000*%
%TD*%
%TA.AperFunction,ComponentPad*%
%ADD81R,2.000000X2.000000*%
%TD*%
%TA.AperFunction,ComponentPad*%
%ADD82C,2.000000*%
%TD*%
%TA.AperFunction,ComponentPad*%
%ADD83C,1.524000*%
%TD*%
%TA.AperFunction,ViaPad*%
%ADD84C,0.600000*%
%TD*%
%TA.AperFunction,ViaPad*%
%ADD85C,0.550000*%
%TD*%
%TA.AperFunction,Conductor*%
%ADD86C,0.254000*%
%TD*%
%TA.AperFunction,Conductor*%
%ADD87C,0.500000*%
%TD*%
%TA.AperFunction,Conductor*%
%ADD88C,0.200000*%
%TD*%
%TA.AperFunction,Conductor*%
%ADD89C,1.800000*%
%TD*%
%TA.AperFunction,Conductor*%
%ADD90C,2.000000*%
%TD*%
%TA.AperFunction,Conductor*%
%ADD91C,0.800000*%
%TD*%
%TA.AperFunction,Profile*%
%ADD92C,0.150000*%
%TD*%
%TA.AperFunction,Profile*%
%ADD93C,0.050000*%
%TD*%
G04 APERTURE END LIST*
D10*
%TO.P,U6,1,VIN*%
%TO.N,/4497dac/dac_vcc*%
X165475000Y-76075000D03*
%TO.P,U6,2,GND*%
%TO.N,GND1*%
X166425000Y-76075000D03*
%TO.P,U6,3,ON/~{OFF}*%
%TO.N,/4497dac/dac_vcc*%
X167375000Y-76075000D03*
%TO.P,U6,4,BP*%
%TO.N,Net-(U6-BP)*%
X167375000Y-73800000D03*
%TO.P,U6,5,VOUT*%
%TO.N,/4497dac/DAC_5.0VA_R*%
X165475000Y-73800000D03*
%TD*%
D11*
%TO.P,C34,1*%
%TO.N,/DAC_3.3VT*%
X133725000Y-97000000D03*
%TO.P,C34,2*%
%TO.N,GND1*%
X132175000Y-97000000D03*
%TD*%
D12*
%TO.P,C56,1*%
%TO.N,Net-(U10B-+)*%
X143025000Y-66400000D03*
%TO.P,C56,2*%
%TO.N,GND1*%
X143025000Y-67950000D03*
%TD*%
D13*
%TO.P,C68,1*%
%TO.N,GND1*%
X128387500Y-84362500D03*
%TO.P,C68,2*%
%TO.N,Net-(U12-VPOS)*%
X128387500Y-82462500D03*
%TD*%
D14*
%TO.P,R32,1*%
%TO.N,Net-(C51-Pad1)*%
X165600000Y-56525000D03*
%TO.P,R32,2*%
%TO.N,/AOUTR+in*%
X167250000Y-56525000D03*
%TD*%
D15*
%TO.P,R71,1*%
%TO.N,/VDD3V3_OUT*%
X138900000Y-135975000D03*
%TO.P,R71,2*%
%TO.N,/DIGTALINTERFACE/PWHOLD_I*%
X138900000Y-134325000D03*
%TD*%
%TO.P,R40,1*%
%TO.N,Net-(U10A--)*%
X131450000Y-61650000D03*
%TO.P,R40,2*%
%TO.N,Net-(C57-Pad1)*%
X131450000Y-60000000D03*
%TD*%
D16*
%TO.P,RN2,1,R1.1*%
%TO.N,Net-(RN2-R1.1)*%
X154575000Y-105200000D03*
D17*
%TO.P,RN2,2,R2.1*%
%TO.N,Net-(RN2-R2.1)*%
X153775000Y-105200000D03*
%TO.P,RN2,3,R3.1*%
%TO.N,Net-(RN2-R3.1)*%
X152975000Y-105200000D03*
D16*
%TO.P,RN2,4,R4.1*%
%TO.N,Net-(RN2-R4.1)*%
X152175000Y-105200000D03*
%TO.P,RN2,5,R4.2*%
%TO.N,/DIGTALINTERFACE/MCLK*%
X152175000Y-107000000D03*
D17*
%TO.P,RN2,6,R3.2*%
%TO.N,/DIGTALINTERFACE/BCLK*%
X152975000Y-107000000D03*
%TO.P,RN2,7,R2.2*%
%TO.N,/DIGTALINTERFACE/DATA*%
X153775000Y-107000000D03*
D16*
%TO.P,RN2,8,R1.2*%
%TO.N,/DIGTALINTERFACE/LRCK*%
X154575000Y-107000000D03*
%TD*%
D18*
%TO.P,C37,1*%
%TO.N,/LN*%
X148600000Y-68400000D03*
D19*
%TO.P,C37,2*%
%TO.N,Net-(C37-Pad2)*%
X148600000Y-65900000D03*
%TD*%
D15*
%TO.P,R83,1*%
%TO.N,/4497dac/SCK-IOS*%
X160425000Y-93600000D03*
%TO.P,R83,2*%
%TO.N,/DAC_3.3VT*%
X160425000Y-91950000D03*
%TD*%
D20*
%TO.P,U21,1,IN*%
%TO.N,/VDD3.3_OUTUSB*%
X156475000Y-113400000D03*
%TO.P,U21,2,S1A*%
%TO.N,/DIGTALINTERFACE/BT_LRCKO*%
X156475000Y-112750000D03*
%TO.P,U21,3,S2A*%
%TO.N,/DIGTALINTERFACE/USB_LRCK*%
X156475000Y-112100000D03*
%TO.P,U21,4,DA*%
%TO.N,/DIGTALINTERFACE/LRCK*%
X156475000Y-111450000D03*
%TO.P,U21,5,S1B*%
%TO.N,/DIGTALINTERFACE/BT_DATAO*%
X156475000Y-110800000D03*
%TO.P,U21,6,S2B*%
%TO.N,/DIGTALINTERFACE/USB_DATA*%
X156475000Y-110150000D03*
%TO.P,U21,7,DB*%
%TO.N,/DIGTALINTERFACE/DATA*%
X156475000Y-109500000D03*
%TO.P,U21,8,GND*%
%TO.N,GND3*%
X156475000Y-108850000D03*
%TO.P,U21,9,DC*%
%TO.N,/DIGTALINTERFACE/BCLK*%
X150750000Y-108850000D03*
%TO.P,U21,10,S2C*%
%TO.N,/DIGTALINTERFACE/USB_BCLK*%
X150750000Y-109500000D03*
%TO.P,U21,11,S1C*%
%TO.N,/DIGTALINTERFACE/BT_BCLKO*%
X150750000Y-110150000D03*
%TO.P,U21,12,DD*%
%TO.N,/DIGTALINTERFACE/MCLK*%
X150750000Y-110800000D03*
%TO.P,U21,13,S2D*%
%TO.N,/DIGTALINTERFACE/USB_MCLK*%
X150750000Y-111450000D03*
%TO.P,U21,14,S1D*%
%TO.N,/DIGTALINTERFACE/BT_MCLKO*%
X150750000Y-112100000D03*
%TO.P,U21,15,EN#*%
%TO.N,GND3*%
X150750000Y-112750000D03*
%TO.P,U21,16,VCC*%
%TO.N,/VDD3V3_OUT*%
X150750000Y-113400000D03*
%TD*%
D15*
%TO.P,R73,1*%
%TO.N,/4497dac/SDA-IOS*%
X162450000Y-93600000D03*
%TO.P,R73,2*%
%TO.N,/DAC_3.3VT*%
X162450000Y-91950000D03*
%TD*%
D11*
%TO.P,C30,1*%
%TO.N,/VCC5V*%
X133675000Y-90875000D03*
%TO.P,C30,2*%
%TO.N,GND1*%
X132125000Y-90875000D03*
%TD*%
D21*
%TO.P,J1,A1,GND*%
%TO.N,GND4*%
X121420000Y-130980000D03*
%TO.P,J1,A4,VBUS*%
%TO.N,/MAIN PWER/VIN*%
X122220000Y-130980000D03*
D22*
%TO.P,J1,A5,CC1*%
%TO.N,Net-(J1-CC1)*%
X123420000Y-130980000D03*
%TO.P,J1,A6,D+*%
%TO.N,unconnected-(J1-D+-PadA6)*%
X124420000Y-130980000D03*
%TO.P,J1,A7,D-*%
%TO.N,unconnected-(J1-D--PadA7)*%
X124920000Y-130980000D03*
%TO.P,J1,A8,SBU1*%
%TO.N,unconnected-(J1-SBU1-PadA8)*%
X125920000Y-130980000D03*
D21*
%TO.P,J1,A9,VBUS*%
%TO.N,/MAIN PWER/VIN*%
X127120000Y-130980000D03*
%TO.P,J1,A12,GND*%
%TO.N,GND4*%
X127920000Y-130980000D03*
%TO.P,J1,B1,GND*%
"#;

fn main() {
    println!("--- Original Gerber Data ---");
    println!("{}\n", GERBER_SAMPLE);

    // Process the Gerber data to add a fingerprint.
    // We pass `false` for `is_foreign_board_file` in this example.
    let processed_data = add_fingerprint(GERBER_SAMPLE, false);

    println!("--- Processed (Fingerprinted) Gerber Data ---");
    println!("{}", processed_data);
}
